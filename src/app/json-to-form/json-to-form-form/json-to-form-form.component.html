<mat-card class="mat-elevation-z8 card-prop">
    <mat-card-content>
        <mat-card-title>Rules for Key Names</mat-card-title>
        <ul>
            <li>Keys have to be surrounded by double quotes.</li>
            <li>White Spaces are not allowed.</li>            
            <li>Key accepts only words, underscore (_), numbers and can end (or not) with a dot followed by an asterisk (<b>.*</b>)</li>
        </ul>
        <mat-divider inset></mat-divider>
        <mat-card-title>Form controls for Array of Objects</mat-card-title>
        <ul>
            <li>
                If the key name ends with a dot followed by an asterisk (<b>.*</b>): It's going to be a HTML of an Array of Objects or Elements.
                <ul> 
                    <li>Ex: "users.*" Array of users.</li>
                    <li>Ex: "users.*.*" 2 level deep nested Array of users.</li>
                </ul>
            </li>
        </ul>
    </mat-card-content>
    <!--
    <mat-card-actions>
        <h3>Examples</h3>
        <section class="valid-examples">
            <h6 class="text-success">Valid (Click below for examples)</h6>
            <mat-selection-list [multiple]="false" color="primary">
                <mat-list-option 
                    class="mat-primary"
                    *ngFor="let valid of examples.valid | keyvalue; let validIndex = index;"
                    (click)="form.patchValue({json: valid.value}); onSubmit();"
                >
                    {{ valid.key }}
                </mat-list-option>
            </mat-selection-list>
        </section>
        <section class="invalid-examples">            
            <h6 class="text-danger">Not Valid (Click below for examples)</h6>
            <mat-selection-list [multiple]="false" color="primary">
                <mat-list-option 
                    class="mat-primary"
                    *ngFor="let invalid of examples.invalid | keyvalue; let invalidIndex = index;"
                    (click)="form.patchValue({json: invalid.value}); onSubmit();"
                >
                    {{ invalid.key }}
                </mat-list-option>
            </mat-selection-list>
        </section>
    </mat-card-actions>
    -->
</mat-card>

<div>
    <mat-card class="mat-elevation-z8 card-prop">
        <mat-card-content>
            <form [formGroup]="form" (ngSubmit)="onSubmit()">
                <label for="__json">JSON</label>
                <json-editor
                    [options]="editorOptions"
                    formControlName="json"
                    [class.is-invalid]="isFieldValid('json')"
                ></json-editor>
                <ng-container *ngIf="form.get('json')?.errors">
                    <div *ngIf="getField('json')!.errors?.invalidJson">
                        <mat-error>
                            Key accepts only words, underscore (_), numbers and can end (or not) with a dot followed by an asterisk (<b>.*</b>)
                        </mat-error>
                        <ng-container *ngFor="let error of getField('json')!.errors?.messages; let indexError = index;">
                            <mat-error>{{ error }}</mat-error>
                        </ng-container>
                    </div>
                </ng-container>

                <br/>
                <fieldset formGroupName="component">
                    <mat-form-field class="full-width-field">
                        <mat-label>Root Component Name</mat-label>
                        <input type="text" matInput formControlName="name" >
                    </mat-form-field>
                    <ng-container *ngIf="isFieldValid('component.name')">
                        <mat-error *ngIf="getField('component.name')!.errors?.required">Component Name is required</mat-error>
                        <ng-container *ngIf="getField('component.name')!.errors?.pattern">
                            <mat-error>Only the characters [a-zA-Z0-9] and hyphen (-)</mat-error>
                            <mat-error>Cannot start with a digit, two hyphens, or a hyphen followed by a digit.</mat-error>
                            <mat-error>White Spaces are not allowed.</mat-error>
                            <mat-error>For example: user-post</mat-error>
                        </ng-container>
                    </ng-container>

                    <fieldset formArrayName="children">
                        <mat-form-field class="full-width-field">
                            <mat-label>Child Components</mat-label>
                            <textarea
                                matInput
                                cols="30"
                                rows="10"
                                [formControl]="text"
                            ></textarea>
                        </mat-form-field>
                        <div *ngFor="let ComponentChildren1Data of getComponentChildren().controls; let indexChildren = index;" class="border border-dark p-1" [formGroupName]="indexChildren">
                            <ng-container *ngIf="getComponentChildren().at(indexChildren)?.get('name')?.hasError('pattern')">
                                <mat-error>
                                    <strong>
                                        <pre>{{ getComponentChildren().at(indexChildren)?.get('name')?.value | json }}</pre>
                                    </strong>
                                </mat-error>
                                <mat-error>Only the characters [a-zA-Z0-9] and hyphen (-)</mat-error>
                                <mat-error>Cannot start with a digit, two hyphens, or a hyphen followed by a digit.</mat-error>
                                <mat-error>White Spaces are not allowed.</mat-error>
                                <mat-error>For example: user-post</mat-error>
                            </ng-container>
                        </div>
                        <!--
                        <button
                            type="button"
                            mat-button
                            (click)="getComponentChildren().push(createComponentChildren())"
                        >
                            <mat-icon>add</mat-icon>
                        </button>                            
                        <div *ngFor="let ComponentChildren1Data of getComponentChildren().controls; let indexChildren = index;" class="border border-dark p-1" [formGroupName]="indexChildren">
                            <mat-form-field class="full-width-field">
                                <mat-label>Name</mat-label>
                                <input type="text" matInput formControlName="name">
                                <button
                                    mat-icon-button
                                    matSuffix
                                    (click)="deleteComponentChildren(indexChildren)"
                                >
                                    <mat-icon>delete_outline</mat-icon>
                                  </button>  
                            </mat-form-field>
                        </div>
                        -->
                    </fieldset>
                </fieldset>
                <!--
                <fieldset formGroupName="component">
                    <mat-form-field class="full-width-field">
                        <mat-label>Component Name</mat-label>
                        <input type="text" matInput formControlName="name" >
                    </mat-form-field>
                    <ng-container *ngIf="isFieldValid('component.name')">
                        <mat-error *ngIf="getField('component.name')!.errors?.required">Component Name is required</mat-error>
                        <ng-container *ngIf="getField('component.name')!.errors?.pattern">
                            <mat-error>Only the characters [a-zA-Z0-9] and hyphen (-)</mat-error>
                            <mat-error>Cannot start with a digit, two hyphens, or a hyphen followed by a digit.</mat-error>
                            <mat-error>White Spaces are not allowed.</mat-error>
                            <mat-error>For example: user-post</mat-error>
                        </ng-container>
                    </ng-container>

                    <fieldset
                        formArrayName="children"
                    >
                        <ng-container
                            *ngFor="let l of getComponentChildren().controls; let indexList = index;"
                            [formGroupName]="indexList"
                        >
                            <mat-form-field class="full-width-field">
                                <mat-label>Name</mat-label>
                                <input type="text" matInput formControlName="name" >
                            </mat-form-field>
                        </ng-container>
                    </fieldset>
                </fieldset>
                -->
            </form>
        </mat-card-content>
    </mat-card>
</div>    

<ng-container *ngIf="(isLoadingAction$ | async)">
    <p class="animate__animated animate__headShake text-white">Loading...</p>
</ng-container>
<ng-container *ngIf="(formBuilder$ | async) as formBuilder">
    <ng-container *ngIf="!(isLoadingAction$ | async )">
        <ng-container *ngIf="form.valid">
            <mat-card class="mat-elevation-z8 card-prop"> 
                <h1>
                    <strong>
                        You need to import ReactiveFormsModule in order to create reactive forms
                    </strong>
                </h1>
                <ul>
                    <li>ng g module {{ form.get('component.name')!.value }} --routing</li>
                    <li>ng g component {{ form.get('component.name')!.value }}</li>
                    <ng-container *ngFor="let l of getComponentChildren().controls; let indexList = index;">
                        <li>ng g component {{ form.get('component.name')!.value }}/{{ form.get('component.name')!.value }}-{{ l.value.name }}</li>
                    </ng-container>
                </ul>
                <fieldset>
                    <h1>{{ form.get('component.name')!.value }}.component.ts</h1>
                    <code id="__form-comonent"><pre>{{ formBuilder.component }}</pre></code>
                </fieldset>
                <fieldset>
                    <h1>{{ form.get('component.name')!.value }}.component.html</h1>
                    <code id="__form-html"><pre>{{ formBuilder.html }}</pre></code>
                </fieldset>

                <!--
                <button mat-button color="primary">Copy</button>                
                <mat-form-field class="full-width-field">
                    <mat-label>COMPONENT</mat-label>
                    <textarea id="__form-comonent" matInput rows="20">{{ formBuilder.component }}</textarea>
                </mat-form-field>
                <button mat-button color="prkmary">Copy</button>
                <mat-form-field class="full-width-field">
                    <mat-label>HTML</mat-label>
                    <textarea id="__form-html" matInput rows="20">{{ formBuilder.html }}</textarea>
                </mat-form-field>
                -->
            </mat-card>
        </ng-container>
    </ng-container>
</ng-container>


